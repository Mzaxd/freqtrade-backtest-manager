# Epic: 为回测详情页增加K线图分析功能

### Epic 目标
作为一名策略分析师，我希望在回测结果详情页面上看到一个包含K线图和交易点的标签页，以便我能够直观地分析和验证我的交易策略在特定市场行情下的具体表现。

### Epic 描述

* **现有系统上下文**:
    * 当前项目 (`freqtrade-backtest-manager`) 是一个基于 Next.js 和 React 的Web应用。
    * 回测详情页 (`/backtests/[id]`) 已经存在，并展示了回测的各项统计指标、交易列表等。
    * 项目UI使用了 `shadcn/ui` 组件库，并已包含如图表 (`EnhancedTradingChart.tsx`) 之类的基础组件。
* **功能增强详情**:
    * 在回测详情页的现有Tabs中增加一个名为 “K线图” 的新Tab。
    * 该Tab页内需要实现一个交互式K线图表。
    * 图表需要能加载并显示当前回测所涉及的**每一个交易对**在回测**开始和结束时间范围内**的K线数据。
    * 图表上需要明确标记出**每一笔交易**的买入和卖出点。
    * 提供一个下拉菜单或切换按钮，允许用户在不同的交易对之间切换，以更新K线图显示。
    * K线图应具备基础的交互功能，如：缩放、平移、显示十字准星等。

### 用户故事 (Stories)

1.  **故事1：UI搭建与基础图表集成**
    * 在回测详情页面添加一个新的Tab “K线图”，并为其创建一个新的面板组件。
    * 在该面板中集成一个基础的K线图组件（可复用或扩展现有的 `EnhancedTradingChart`）。
    * 实现一个交易对选择器（如下拉菜单），用于未来切换不同的交易对。

2.  **故事2：数据接口与图表数据加载**
    * 创建一个新的API端点，该端点能够根据回测ID和指定的交易对，返回相应时间范围内的K线数据和该交易对的所有交易记录。
    * 在前端K线图组件中调用此API，获取默认交易对的数据，并将K线和交易点正确渲染到图表上。

3.  **故事3：实现交易对切换与图表交互**
    * 将交易对选择器与数据加载逻辑关联起来，当用户选择新的交易对时，图表能够动态刷新以显示新数据。
    * 确保K线图的基础交互功能（缩放、平移等）工作正常。
    * 对图表进行性能优化，确保在数据量较大时依然保持流畅。

### 兼容性要求
* 新功能的增加不得影响回测详情页其他Tab的现有功能。
* 新添加的UI组件必须遵循项目现有的设计规范和风格。
* API的增加不能对现有后端服务造成性能瓶颈。

### 风险与规避
* **主要风险**: 大量K线数据和交易数据可能会导致前端页面加载缓慢或卡顿。
* **规避措施**: 后端API进行数据预处理和优化。前端采用虚拟化或懒加载技术渲染图表，并考虑对数据进行适当的抽样或聚合。
* **回滚计划**: 如果出现严重问题，可以通过移除 “K线图” Tab的UI代码来快速回滚此功能。

### 完成定义 (Definition of Done)
- [ ] “K线图” Tab已成功添加到回测详情页。
- [ ] K线图能够正确显示至少一个交易对的K线和交易点。
- [ ] 用户可以通过UI控件切换并查看所有相关交易对的图表。
- [ ] 图表的交互功能（缩放、平移）均可正常使用。
- [ ] 现有功能经过测试，未出现回归性问题。